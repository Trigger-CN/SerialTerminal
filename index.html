<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Serial Terminal</title>
    <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css" />
    <style>
        /* Global Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: transparent; 
        }
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #1e1e1e;
            color: #ccc;
            height: 100vh;
            display: flex;
            flex-direction: row;
            overflow: hidden;
        }
        .sidebar {
            width: 200px;
            background: #252526;
            display: flex;
            flex-direction: column;
            padding: 0;
            border-right: 1px solid #333;
            flex-shrink: 0;
            overflow: hidden;
        }
        .sidebar-header {
            padding: 10px;
            background: #252526;
            border-bottom: 1px solid #333;
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex-shrink: 0;
        }
        .sidebar-tabs {
            display: flex;
            background: #1e1e1e;
            border-bottom: 1px solid #333;
            flex-shrink: 0;
        }
        .sidebar-tab {
            flex: 1;
            padding: 8px 0;
            text-align: center;
            cursor: pointer;
            color: #888;
            font-size: 16px;
            border: none;
            background: transparent;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            border-radius: 0;
        }
        .sidebar-tab:hover {
            background: #2a2d2e;
            color: #ccc;
        }
        .sidebar-tab.active {
            color: #fff;
            border-bottom-color: #007acc;
            background: #252526;
        }
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            background: #252526;
        }
        .sidebar-tab-pane {
            display: none;
            animation: fadeIn 0.2s;
        }
        .sidebar-tab-pane.active {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .sidebar-footer {
            padding: 10px;
            border-top: 1px solid #333;
            background: #252526;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .mode-toggle {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
        }
        .mode-btn {
            padding: 10px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #aaa;
            transition: all 0.2s;
            border: none;
            background: transparent;
            text-align: left;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .mode-btn:hover {
            background: #333;
            color: #fff;
        }
        .mode-btn.active {
            background: #007acc;
            color: #fff;
        }
        .settings-btn {
            margin-top: auto;
            padding: 10px 12px;
            cursor: pointer;
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 6px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.2s;
        }
        .settings-btn:hover {
            background: #333;
            color: #fff;
        }
        .main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 0;
            background: #1e1e1e;
            overflow: hidden;
            height: 100vh;
        }
        .terminal-wrapper {
            flex: 1;
            background: #000;
            overflow: hidden;
        }
        .controls {
            padding: 0;
            background: transparent;
            border-radius: 0;
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            gap: 8px;
            border: none;
            animation: fadeIn 0.3s ease-in;
            border-top: 1px solid #333;
            padding-top: 10px;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        select, button, input, textarea {
            background: #3c3c3c;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 6px;
            outline: none;
            width: 100%;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            font-family: Consolas, "Courier New", monospace;
        }
        button {
            background: #007acc;
            border: none;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #008be5;
        }
        button.secondary {
            background: #444;
        }
        button.secondary:hover {
            background: #555;
        }
        .status {
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 5px;
            padding: 5px;
            background: #1e1e1e;
            border-radius: 4px;
        }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff4d4f;
        }
        .status-dot.online {
            background: #52c41a;
        }
        /* Advanced Settings Styles */
        details {
            width: 100%;
            border: 1px solid #333;
            border-radius: 6px;
            background: #2d2d2d;
            overflow: hidden;
        }
        summary {
            padding: 8px 12px;
            cursor: pointer;
            font-size: 13px;
            color: #ccc;
            user-select: none;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        summary:hover {
            background: #3c3c3c;
            color: #fff;
        }
        .advanced-content {
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <!-- Persistent Header -->
        <div class="sidebar-header">
            <select id="port-select" title="Select Serial Port">
                <option value="">Select Port</option>
            </select>
            <div id="baud-container" style="position: relative;">
                <select id="baud-select" title="Select Baud Rate">
                    <option value="110">110</option>
                    <option value="300">300</option>
                    <option value="600">600</option>
                    <option value="1200">1200</option>
                    <option value="2400">2400</option>
                    <option value="4800">4800</option>
                    <option value="9600">9600</option>
                    <option value="14400">14400</option>
                    <option value="19200">19200</option>
                    <option value="38400">38400</option>
                    <option value="56000">56000</option>
                    <option value="57600">57600</option>
                    <option value="115200" selected>115200</option>
                    <option value="128000">128000</option>
                    <option value="256000">256000</option>
                    <option value="460800">460800</option>
                    <option value="512000">512000</option>
                    <option value="921600">921600</option>
                    <option value="1000000">1000000</option>
                    <option value="2000000">2000000</option>
                    <option value="custom">‚úé Custom...</option>
                </select>
                <div id="baud-custom-wrapper" style="display: none; display: flex; gap: 5px;">
                    <input type="number" id="baud-custom-input" placeholder="Baud Rate">
                    <button id="baud-custom-cancel" class="secondary" style="width: auto; padding: 0 8px;" title="Back to list">‚úï</button>
                </div>
            </div>

            <div style="display: flex; gap: 5px;">
                <button id="connect-btn" style="flex: 2;">‚ö° Connect</button>
                <button class="secondary" id="refresh-btn" style="flex: 1;" title="Refresh Ports">üîÑ</button>
            </div>

            <div class="status">
                <div id="status-dot" class="status-dot"></div>
                <span id="serial-status">Disconnected</span>
            </div>
        </div>

        <!-- Tabs Header -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="showSidebarTab('tab-settings')" title="Settings">üõ†Ô∏è</button>
            <button class="sidebar-tab" onclick="showSidebarTab('tab-search')" title="Search">üîç</button>
            <button class="sidebar-tab" onclick="showSidebarTab('tab-send')" title="Send">üì§</button>
        </div>

        <!-- Tab Content -->
        <div class="sidebar-content">
            <!-- Settings Tab -->
            <div id="tab-settings" class="sidebar-tab-pane active">
                <select id="data-bits-select" title="Data Bits">
                    <option value="8" selected>Data Bits: 8</option>
                    <option value="7">Data Bits: 7</option>
                    <option value="6">Data Bits: 6</option>
                    <option value="5">Data Bits: 5</option>
                </select>

                <select id="stop-bits-select" title="Stop Bits">
                    <option value="1" selected>Stop Bits: 1</option>
                    <option value="1.5">Stop Bits: 1.5</option>
                    <option value="2">Stop Bits: 2</option>
                </select>

                <select id="parity-select" title="Parity">
                    <option value="none" selected>Parity: None</option>
                    <option value="even">Parity: Even</option>
                    <option value="odd">Parity: Odd</option>
                    <option value="mark">Parity: Mark</option>
                    <option value="space">Parity: Space</option>
                </select>

                <select id="encoding-select" title="Encoding">
                    <option value="utf8" selected>Enc: UTF-8</option>
                    <option value="ascii">Enc: ASCII</option>
                    <option value="hex">Enc: Hex</option>
                    <option value="gbk">Enc: GBK</option>
                </select>

                <select id="newline-mode-select" title="Newline Mode (Receive/Send)">
                    <option value="crlf" selected>NL: CRLF / CRLF</option>
                    <option value="lf">NL: LF / LF</option>
                    <option value="cr">NL: CR / CR</option>
                </select>

                <div id="display-controls" style="display: flex; flex-direction: column; gap: 8px; padding-top: 5px; border-top: 1px solid #444;">
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; color: #ccc;">
                        <input type="checkbox" id="show-timestamp" style="width: auto; margin: 0;"> üïí Show Time
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; color: #ccc;">
                        <input type="checkbox" id="show-lineno" style="width: auto; margin: 0;"> üî¢ Show Line #
                    </label>
                </div>
            </div>

            <!-- Search Tab -->
            <div id="tab-search" class="sidebar-tab-pane">
                <input type="text" id="search-input" placeholder="Search..." style="margin-bottom: 5px;">
                <div style="display: flex; gap: 5px;">
                    <button id="find-prev-btn" style="flex: 1;">Prev</button>
                    <button id="find-next-btn" style="flex: 1;">Next</button>
                </div>
                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; color: #ccc; margin-top: 5px;">
                    <input type="checkbox" id="search-regex" style="width: auto; margin: 0;"> .* Regex
                </label>
                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; color: #ccc;">
                    <input type="checkbox" id="search-case" style="width: auto; margin: 0;"> Aa Case Sensitive
                </label>
                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; color: #ccc;">
                    <input type="checkbox" id="search-word" style="width: auto; margin: 0;"> üî† Whole Word
                </label>
            </div>

            <!-- Send Tab -->
            <div id="tab-send" class="sidebar-tab-pane">
                <!-- Auto Send -->
                <div style="border-bottom: 1px solid #444; padding-bottom: 8px; margin-bottom: 8px;">
                    <div style="display: flex; align-items: center; gap: 5px; margin-bottom: 5px;">
                        <input type="checkbox" id="auto-send-enable" style="width: auto; margin: 0;">
                        <label for="auto-send-enable" style="font-size: 13px; color: #ccc; cursor: pointer;">Auto Send</label>
                        <input type="number" id="auto-send-interval" placeholder="ms" value="1000" style="width: 60px; padding: 4px; margin-left: auto;">
                    </div>
                    <textarea id="auto-send-text" placeholder="Text to auto send..." style="margin-bottom: 5px; height: 60px;"></textarea>
                </div>
        
                <!-- Quick Send -->
                <div style="font-size: 13px; margin-bottom: 5px; color: #ccc; display: flex; justify-content: space-between; align-items: center;">
                    <span>Quick Send List</span>
                </div>
                <div id="quick-send-list" style="display: flex; flex-direction: column; gap: 5px; max-height: 200px; overflow-y: auto; margin-bottom: 8px;">
                    <!-- Items will be added here -->
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 5px; margin-bottom: 5px;">
                    <input type="text" id="quick-send-label" placeholder="Label">
                    <textarea id="quick-send-content" placeholder="Content (multi-line)" style="height: 60px;"></textarea>
                </div>
                <button id="add-quick-send-btn" class="secondary" style="width: 100%;">+ Add to List</button>
            </div>
        </div>

        <div class="sidebar-footer">
            <button id="new-filter-window-btn" style="background-color: #4CAF50;">‚ûï Filter Window</button>
            <div class="settings-btn" id="open-prefs" title="Settings" style="justify-content: center;">
                ‚öôÔ∏è Global Settings
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Terminal container removed temporarily -->
        <div class="terminal-wrapper" id="serial-container"></div>
    </div>

    <script src="renderer.js"></script>
    <script>
        document.getElementById('open-prefs').onclick = () => {
            const { ipcRenderer } = require('electron');
            ipcRenderer.send('open-prefs');
        };

        function showSidebarTab(tabId) {
            // Hide all tab panes
            document.querySelectorAll('.sidebar-tab-pane').forEach(el => {
                el.classList.remove('active');
            });
            // Deactivate all tab buttons
            document.querySelectorAll('.sidebar-tab').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(tabId).classList.add('active');
            
            // Activate clicked button
            // Find the button that calls this function with this tabId
            const buttons = document.querySelectorAll('.sidebar-tab');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(tabId)) {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
