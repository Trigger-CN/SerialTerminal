<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Serial Terminal</title>
    <link rel="stylesheet" href="node_modules/@xterm/xterm/css/xterm.css" />
    <link rel="stylesheet" href="style.css" />
    <style>
        body {
            height: 100vh;
            display: flex;
            flex-direction: row;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <!-- Persistent Header -->
        <div class="sidebar-header">
            <div style="display: flex; gap: 4px;">
                <select id="port-select" title="Select Serial Port" style="flex: 1; width: 0;">
                    <option value="">Select Port</option>
                </select>
                <button class="secondary" id="refresh-btn" style="flex: 0 0 auto; padding: 0 8px;" title="Refresh Ports">üîÑ</button>
            </div>

            <div id="baud-container" style="position: relative;">
                <select id="baud-select" title="Select Baud Rate" style="width: 100%;">
                    <option value="110">110</option>
                    <option value="300">300</option>
                    <option value="600">600</option>
                    <option value="1200">1200</option>
                    <option value="2400">2400</option>
                    <option value="4800">4800</option>
                    <option value="9600">9600</option>
                    <option value="14400">14400</option>
                    <option value="19200">19200</option>
                    <option value="38400">38400</option>
                    <option value="56000">56000</option>
                    <option value="57600">57600</option>
                    <option value="115200" selected>115200</option>
                    <option value="128000">128000</option>
                    <option value="256000">256000</option>
                    <option value="460800">460800</option>
                    <option value="512000">512000</option>
                    <option value="921600">921600</option>
                    <option value="1000000">1000000</option>
                    <option value="2000000">2000000</option>
                    <option value="custom">‚úé Custom...</option>
                </select>
                <div id="baud-custom-wrapper" style="display: none; display: flex; gap: 4px;">
                    <input type="number" id="baud-custom-input" placeholder="Baud Rate" style="flex: 1; width: 0;">
                    <button id="baud-custom-cancel" class="secondary" style="width: auto; padding: 0 6px;" title="Back to list">‚úï</button>
                </div>
            </div>

            <button id="connect-btn" style="width: 100%;">‚ö° Connect</button>
            <button id="clear-btn" class="secondary" title="Clear Terminal Output" style="width: 100%;">üóëÔ∏è Clear Log</button>

            <div class="status">
                <div id="status-dot" class="status-dot"></div>
                <span id="serial-status">Disconnected</span>
            </div>
        </div>

        <!-- Tabs Header -->
        <div class="sidebar-tabs">
            <button class="sidebar-tab active" onclick="showSidebarTab('tab-settings')" title="Settings">üõ†Ô∏è</button>
            <button class="sidebar-tab" onclick="showSidebarTab('tab-search')" title="Search">üîç</button>
            <button class="sidebar-tab" onclick="showSidebarTab('tab-send')" title="Send">üì§</button>
        </div>

        <!-- Tab Content -->
        <div class="sidebar-content">
            <!-- Settings Tab -->
            <div id="tab-settings" class="sidebar-tab-pane active">
                <select id="data-bits-select" title="Data Bits">
                    <option value="8" selected>Data Bits: 8</option>
                    <option value="7">Data Bits: 7</option>
                    <option value="6">Data Bits: 6</option>
                    <option value="5">Data Bits: 5</option>
                </select>

                <select id="stop-bits-select" title="Stop Bits">
                    <option value="1" selected>Stop Bits: 1</option>
                    <option value="1.5">Stop Bits: 1.5</option>
                    <option value="2">Stop Bits: 2</option>
                </select>

                <select id="parity-select" title="Parity">
                    <option value="none" selected>Parity: None</option>
                    <option value="even">Parity: Even</option>
                    <option value="odd">Parity: Odd</option>
                    <option value="mark">Parity: Mark</option>
                    <option value="space">Parity: Space</option>
                </select>

                <select id="encoding-select" title="Encoding">
                    <option value="utf8" selected>Enc: UTF-8</option>
                    <option value="ascii">Enc: ASCII</option>
                    <option value="hex">Enc: Hex</option>
                    <option value="gbk">Enc: GBK</option>
                </select>

                <select id="newline-mode-select" title="Newline Mode (Receive/Send)">
                    <option value="crlf" selected>NL: CRLF / CRLF</option>
                    <option value="lf">NL: LF / LF</option>
                    <option value="cr">NL: CR / CR</option>
                </select>

                <div id="display-controls" class="settings-group">
                    <label>
                        <input type="checkbox" id="show-timestamp"> üïí Show Time
                    </label>
                    <label>
                        <input type="checkbox" id="show-lineno"> üî¢ Show Line #
                    </label>
                </div>
            </div>

            <!-- Search Tab -->
            <div id="tab-search" class="sidebar-tab-pane">
                <input type="text" id="search-input" placeholder="Search..." style="margin-bottom: 4px;">
                <div style="display: flex; gap: 4px;">
                    <button id="find-prev-btn" style="flex: 1;">Prev</button>
                    <button id="find-next-btn" style="flex: 1;">Next</button>
                </div>
                <label style="margin-top: 4px;">
                    <input type="checkbox" id="search-regex"> .* Regex
                </label>
                <label>
                    <input type="checkbox" id="search-case"> Aa Case Sensitive
                </label>
                <label>
                    <input type="checkbox" id="search-word"> üî† Whole Word
                </label>
            </div>

            <!-- Send Tab -->
            <div id="tab-send" class="sidebar-tab-pane">
                <!-- Auto Send -->
                <div style="border-bottom: 1px solid var(--border-color); padding-bottom: 6px; margin-bottom: 6px;">
                    <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 4px;">
                        <input type="checkbox" id="auto-send-enable">
                        <label for="auto-send-enable" style="font-size: 13px; color: var(--text-primary); cursor: pointer; display: inline;">Auto Send</label>
                        <input type="number" id="auto-send-interval" placeholder="ms" value="1000" style="width: 60px; padding: 4px; margin-left: auto;">
                    </div>
                    <textarea id="auto-send-text" placeholder="Text to auto send..." style="margin-bottom: 4px; height: 60px;"></textarea>
                </div>
        
                <!-- Quick Send -->
                <div style="font-size: 13px; margin-bottom: 4px; color: var(--text-primary); display: flex; justify-content: space-between; align-items: center;">
                    <span>Quick Send List</span>
                </div>
                <div id="quick-send-list" class="quick-send-list-container">
                    <!-- Items will be added here -->
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 4px; margin-bottom: 4px;">
                    <input type="text" id="quick-send-label" placeholder="Label">
                    <textarea id="quick-send-content" placeholder="Content (multi-line)" style="height: 60px;"></textarea>
                </div>
                <button id="add-quick-send-btn" class="secondary" style="width: 100%;">+ Add to List</button>
            </div>
        </div>

        <div class="sidebar-footer">
            <button id="new-filter-window-btn" class="footer-btn primary">‚ûï Filter Window</button>
            <div id="open-prefs" class="footer-btn settings" title="Settings">
                ‚öôÔ∏è Global Settings
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Terminal container removed temporarily -->
        <div class="terminal-wrapper" id="serial-container"></div>
    </div>

    <script src="renderer.js"></script>
    <script>
        document.getElementById('open-prefs').onclick = () => {
            const { ipcRenderer } = require('electron');
            ipcRenderer.send('open-prefs');
        };

        function showSidebarTab(tabId) {
            // Hide all tab panes
            document.querySelectorAll('.sidebar-tab-pane').forEach(el => {
                el.classList.remove('active');
            });
            // Deactivate all tab buttons
            document.querySelectorAll('.sidebar-tab').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show selected tab pane
            document.getElementById(tabId).classList.add('active');
            
            // Activate clicked button
            // Find the button that calls this function with this tabId
            const buttons = document.querySelectorAll('.sidebar-tab');
            buttons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(tabId)) {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
